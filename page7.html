





<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Page 8 &mdash; Whitewashing</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.3.1b',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/disqus.js"></script>
    <script type="text/javascript" src="_static/ga.js"></script>
    <link rel="shortcut icon" href="_static/tinkerer.ico"/>
    
    <link rel="top" title="Whitewashing" href="index.html" />
    <link rel="next" title="Older" href="page8.html" />
    <link rel="prev" title="Newer" href="page6.html" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.html"> 
  </head>
  <body>
<div class="container">
    <div id="header" class="span-8">
        <a href="index.html"><img src="_static/logo.jpg" alt="Whitewashing.de" /></a>
    </div>
    <div class="span-16 last" id="about">
        <p>Whitewashing is the blog of Benjamin Eberlei and covers topics in programming, databases and other topics of interest.</p>

        <p class="buttons">
            <a href="http://www.twitter.com/beberlei"><img src="http://twitter-badges.s3.amazonaws.com/follow_me-a.png" alt="Follow beberlei on Twitter"/></a>
            <a href="http://www.whitewashing.de/rss.xml"><img src="_static/rss.png" alt="Subscribe to RSS" /></a>
        </p>
    </div>
</div>



    <div class="document">
<div class="container">
    
    <div class="span-24 content">
      <div>
        <div>
          <div id="page7">
            
            
    
    <div class="related">
        <ul>
            <li>
                 &laquo; <a href="page6.html">Newer</a>
            </li>
            <li class="right">
                <a href="page8.html">Older</a> &raquo; 
            </li>
        </ul>
    </div>
        
        <div class="timestamp postmeta">
            <span>January 24, 2008</span> 
        </div>
        <?xml version="1.0" ?><div class="section" id="complaining-about-zend-filter-input">
<a href="2008/01/24/complaining-about-zend-filter-input.html"><h1>Complaining about Zend_Filter_Input</h1></a>
<p>Zend_Filter_Input is really nice to be sure form data is filtered
correctly, but i have some serious complaints: Why the hell are the
error messages so user-unfriendly? I really would like to use the output
of Zend_Filter_Input::getMessages(), but I could never trust to show
them to a user of my website: They are obviously written for developers.
Some examples:</p>
<blockquote>
<div>‘’ does not appear to be an integer ‘’ is an empty string</div></blockquote>
<p>I use a ton of validators to filter the comments form and all possible
error messages that can be thrown are not “user-save”. Because all these
messages are handled in each Validator class its almost impossible to
change them without going nuts:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">$validators = array(</span>
<span class="x">    'article_id' =&gt; array(</span>
<span class="x">        'Int',</span>
<span class="x">        new Zend_Validate_Int(),</span>
<span class="x">        array('GreaterThan', 0)</span>
<span class="x">        ),</span>
<span class="x">    'username' =&gt; 'Alnum',</span>
<span class="x">    'userEmail' =&gt; new Zend_Validate_EmailAddress(Zend_Validate_Hostname::ALLOW_DNS | Zend_Validate_Hostname::ALLOW_LOCAL, true),</span>
<span class="x">    'cp'   =&gt; array(</span>
<span class="x">        'Digits',                // string</span>
<span class="x">        new Zend_Validate_Int(), // object instance</span>
<span class="x">        array('Between', 1138, 1138)  // string with constructor arguments</span>
<span class="x">    ),</span>
<span class="x">    'comment' =&gt; 'NotEmpty',</span>
<span class="x">);</span>
</pre></div>
</div>
<p>This simple $validators requirement creates templates for error
messages in each validator object, that are: Zend_Validate_Int,
Zend_Validate_Alnum, Zend_Validate_EmailAddress,
Zend_Validate_Hostname, and the not empty message. To allow for user
friendly messages one had to make child objects of each of the
Validators and edit the error messages accordingly. I avoid this by
printing my own errors from outside the Zend_Filter_Input, rather than
using the object for what it is propably supposed to do.</p>
</div>
        
    <div class="postmeta">
        
        <div class="author">
            <span>Posted by beberlei <kontakt@beberlei.de></span>
        </div>
        
        
        
        <div class="comments">
            <a href="http://www.whitewashing.de/2008/01/24/complaining-about-zend-filter-input.html#disqus_thread" data-disqus-identifier="2008/01/24/complaining-about-zend-filter-input">Leave a comment</a>
        </div>
    </div><div class="separator post_separator"></div>
        
        <div class="timestamp postmeta">
            <span>January 24, 2008</span> 
        </div>
        <?xml version="1.0" ?><div class="section" id="how-my-zend-db-table-models-look-like">
<a href="2008/01/24/how-my-zend-db-table-models-look-like.html"><h1>How my Zend_Db_Table models look like</h1></a>
<p>I am not too happy with the ZF Frameworks Table access solution. Not
that I have anything against the <a class="reference external" href="http://martinfowler.com/eaaCatalog/tableDataGateway.html">Table Gateway
pattern</a>,
but in most web applications you almost always have to join data some
way or another. Even this rather simple application, a blog, needs joins
for displaying articles so that category, comment count and tags can be
displayed. Therefore I use an instance of Zend_Db_Table_Abstract only
for the simplest purposes and pimp it by using lots of public methods
and
<a class="reference external" href="http://framework.zend.com/manual/en/zend.db.select.html">Zend_Db_Select</a>.
An example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">class SomeModel extends Zend_Db_Table_Abstract</span>
<span class="x">{</span>
<span class="x">  $_name = &quot;someTable&quot;;</span>
<span class="x">  $_primary = &quot;id&quot;;</span>

<span class="x">  public function getSomethingByJoin($param1, $param2)</span>
<span class="x">  {</span>
<span class="x">     $db = $this-&gt;getAdapter();</span>
<span class="x">     $select = $db-&gt;select();</span>
<span class="x">     ...[build select]</span>
<span class="x">     $result = $db-&gt;query($select);</span>

<span class="x">     return $result;</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
<p>That way you still follow the MVC pattern and don’t have to take one
compromise after another for getting the Table Gateway to reproduce a
result that looks like a join.</p>
</div>
        
    <div class="postmeta">
        
        <div class="author">
            <span>Posted by beberlei <kontakt@beberlei.de></span>
        </div>
        
        
        
        <div class="comments">
            <a href="http://www.whitewashing.de/2008/01/24/how-my-zend-db-table-models-look-like.html#disqus_thread" data-disqus-identifier="2008/01/24/how-my-zend-db-table-models-look-like">Leave a comment</a>
        </div>
    </div><div class="separator post_separator"></div>
        
        <div class="timestamp postmeta">
            <span>October 30, 2008</span> 
        </div>
        <?xml version="1.0" ?><div class="section" id="php-conference-recap-netbeans-ezcomponents-mapreduce">
<a href="2008/10/30/php-conference-recap-netbeans-ezcomponents-mapreduce.html"><h1>PHP Conference Recap: NetBeans, ezComponents, MapReduce..</h1></a>
<p>This years october edition of <a class="reference external" href="http://www.phpconference.de">IPC</a> in
Mainz, Germany was the first php conference I have been to. It ended
some hours ago and i am quite happy to have been there. I had several
great discussions which pointed me to new stuff (to follow) and also met
great people.</p>
<p>First thing that completly fascinated me is <a class="reference external" href="http://download.netbeans.org/netbeans/6.5/rc/">NetBeans 6.5 with PHP
support</a>. It feels much
more easy to use than Eclipse PDT. Its faster (from the little tests i
could make) and does not strike when you add several large libraries
into the include path. It offers much more help on refactoring and
organizing than Eclipse PDT does, for example it offers to generate
getter/setter, constructor, inheritence methods. Much thanks to Petr who
explained to me in detail how NetBeans works.</p>
<p>Ez had lots of people at the conference (to Kore and Tobias i spoke in
more detail) and I had some talks with them about
<a class="reference external" href="http://www.ezcomponents.org">ezComponents</a>. This was especially
interesting after the great session on object persistence in ez, aswell
when I heard that ezcMvc, a model-view-controller component, wil be
included in the next release of ezc in Dezember 2008. ezComponents has a
Database layer, that does not seem to enforce too much overhead on you
but still offers great extensibility through a persistence layer and a
library that offers to build Database Diffs. The latter feature is
really great and I will definatly have a look at this.</p>
<p>Sebastian Bergmann had a great talk on MapReduce which is an old LISP
programming paradigm to work with huge datasets. This style was recently
<a class="reference external" href="http://labs.google.com/papers/mapreduce.html">revived by Google</a>
because tasks can easily be split and distributed for computing on
differend nodes with hundrets of threads. Implementing a working example
in PHP is really easy, just finding a good way to process your large
data seems to be a topic that needs lots of thinking.</p>
<p>Addtional great things:</p>
<ul class="simple">
<li>Meet Thomas, the guy that wrote Weaverslave (I use it for years to
build simple php applications).</li>
<li>He is working on a cool open source project <a class="reference external" href="http://sourceforge.net/projects/ccg/">Carica
Cachegrind</a> with Bastian
Feder that will process xdebug cachegrind files via a webinterface
(They told me webgrind is actually calculating the numbers wrong).</li>
<li>Jan Lehnhart and Kore Nordmann had some great things to say about
<a class="reference external" href="http://incubator.apache.org/couchdb/">CouchDB</a>.</li>
<li>Brian Acker talked about <a class="reference external" href="https://launchpad.net/drizzle">Drizzle</a>,
which is a forked MySQL that throws out lots of legecy stuff from
MySQL out, to build a micro-kernel database server that suites the
web.</li>
<li>Ulf Wendel talked about Mysqli + Mysqlnd.
<a class="reference external" href="http://dev.mysql.com/downloads/connector/php-mysqlnd/">Mysqlnd</a>
will be a new internal driver for PHP to access MySQL through Mysqli
and optimizes processing and memory consumption. Additionally Mysqli
will be extended to offer asynchroneous queries that can be fired at
the database and polled latter. To be included in PHP 5.3</li>
</ul>
<p>Not so good things: There were absolutly to few power lines. People
using their notebooks were packed on hotspots where power was available.
Please more power plug possibilites next time!</p>
</div>
        
    <div class="postmeta">
        
        <div class="author">
            <span>Posted by beberlei <kontakt@beberlei.de></span>
        </div>
        
        
        
        <div class="comments">
            <a href="http://www.whitewashing.de/2008/10/30/php-conference-recap-netbeans-ezcomponents-mapreduce.html#disqus_thread" data-disqus-identifier="2008/10/30/php-conference-recap-netbeans-ezcomponents-mapreduce">Leave a comment</a>
        </div>
    </div><div class="separator post_separator"></div>
        
        <div class="timestamp postmeta">
            <span>October 01, 2008</span> 
        </div>
        <?xml version="1.0" ?><div class="section" id="my-recent-zf-ongoings-jquery-action-controller-couchdb">
<a href="2008/10/01/my-recent-zf-ongoings-jquery-action-controller-couchdb.html"><h1>My recent ZF ongoings: JQuery, Action Controller, CouchDb</h1></a>
<p>In the last weeks lots of stuff came up for me regarding the Zend
Framework. My <a class="reference external" href="http://jquery.com">jQuery</a> component is finished, i
have even commited the documentation into the SVN already. Do read it
you have to be either an XML fetishist or compile it using a docbook
compiler. Lots of questions about ZF and jQuery come up regularly on the
mailing lists so I really look forward for the first ZF 1.7 release
candidate which will include the helpers for a broader audience. This
component comes at a good point, since <a class="reference external" href="http://jquery.com/blog/2008/09/28/jquery-microsoft-nokia/">a few days ago the jQuery team
announced a deal with Microsoft and
Nokia</a>.
Microsoft will include jQuery as the framework to go into its Webbased
ASP.Net applications and Nokia will include the library in their mobile
phones.</p>
<p>Additionaly i reported an <a class="reference external" href="http://framework.zend.com/issues/browse/ZF-4385">important issue
(ZF-4385)</a> that
offers a patch to create an interface of the Action Controller and
therefore allows everyone to implement their own action controller
classes. May it be lightweight implementations or like my current
use-case webservice only controllers that route all their actions
through soap, xml-rpc or a rest server. I would really appreciate if
more people would vote +1 on this issue to get it included in 1.7</p>
<p>In the last weeks i also played around with
<a class="reference external" href="http://incubator.apache.org/couchdb/docs/overview.html">CouchDb</a>, a
document based database. Its the perfect storage medium for blogs, wikis
or other knowledge-based applications and comes with a lightweight and
easy REST Api for ClientSide access. Within the
<a class="reference external" href="http://www.zym-project.com">Zym</a> project i managed to implement a
prototype that is based on Jurrien’s prototype for a CouchDb client.
<a class="reference external" href="http://framework.zend.com/wiki/display/ZFPROP/Zend_Couch+-+Matthew+Weier+O'Phinney">Matthew of Zend Fame published a proposal for a Zend
Couch</a>
component yesterday and we teamed up to implement two prototypes
(<a class="reference external" href="http://github.com/weierophinney/phly/tree/beberlei">mine</a> is based
on <a class="reference external" href="http://github.com/weierophinney/phly/tree/master">Matthews</a> and
integrates lots of stuff of the Zym component).</p>
</div>
        
    <div class="postmeta">
        
        <div class="author">
            <span>Posted by beberlei <kontakt@beberlei.de></span>
        </div>
        
        
        
        <div class="comments">
            <a href="http://www.whitewashing.de/2008/10/01/my-recent-zf-ongoings-jquery-action-controller-couchdb.html#disqus_thread" data-disqus-identifier="2008/10/01/my-recent-zf-ongoings-jquery-action-controller-couchdb">Leave a comment</a>
        </div>
    </div><div class="separator post_separator"></div>
        
        <div class="timestamp postmeta">
            <span>April 27, 2008</span> 
        </div>
        <?xml version="1.0" ?><div class="section" id="ox-cross-correlation-coefficients-with-lags">
<a href="2008/04/27/ox-cross-correlation-coefficients-with-lags.html"><h1>Ox: Cross-correlation coefficients with lags</h1></a>
<p>Working on the homework for my <a class="reference external" href="http://mueller.gernot.googlepages.com/monetaryeconomics">Monetary Economics
class</a> I
realized that <a class="reference external" href="http://www.doornik.com">Ox</a> has different mechanisms to
calculate correlation coefficients like Mathlab has.</p>
<p>Our assignement was to replicate the Dynamic Correlations graph in
<a class="reference external" href="http://www.amazon.de/gp/redirect.html?ie=UTF8&amp;location=http://www.amazon.de/Monetary-Theory-Policy-Carl-Walsh/dp/0262232316?ie=UTF8&amp;s=books-intl-de&amp;qid=1209289935&amp;sr=8-1&amp;site-redirect=de&amp;tag=economystuden-21&amp;linkCode=ur2&amp;camp=1638&amp;creative=6742">Walshs’ Monetary Theory and
Policy</a>
for European Data, which shows the cross-correlation of different
monetary aggregates (M0,M1,M2) with GDP over lagging periods of -8 to +8
quarters.</p>
<p>What was missing for me to do that assignment in Ox was a function to
calculate cross-correlation coefficients for two vectors for a specified
lag length:</p>
<blockquote>
<div><div class="highlight-python"><pre>#include &lt;oxfloat.h&gt;

/**
 * Computes the cross-correlation coefficient for two vector series allowing
 * to optionally specify the number of positive and negative lags the ccc
 * should be calculated for.
 *
 * @author Benjamin Eberlei (kontakt at beberlei dot de)
 * @param vVarY Tx1 vector of variable related to
 * @param vVarX Tx1 vector of variable which is tested in different lags
 * @param lags Integer indicating the number of negative and positive lags.
 * @returns (1+lags*2)*1 vector of correlations from -lags to lags
 **/
ccf(const vVarY, const vVarX, const lags)
{
    // Generate positive and negative lags of given length and fill with NaN, so
    // that rows with not available numbers can be dropped from calculating the CCF later on.
    decl mXLag = lag0(vVarX, range(lags, -lags), M_NAN);

    decl mCorr, sCov;

    // initialize result vector holding one crosscorrelation per lag
    decl vCorrLags = zeros(1+lags*2, 1);

    // sadly there are no matrix operations to ease this computation, loop over all lags
    for(decl i = 0; i &lt; 1+lags*2; i++) {
        mCorr = deleter(vVarY ~ mXLag[][i]); // stick y and current lagged x together and delete NaN rows

        // calculate covariance of both time series
        sCov = 1/(rows(mCorr)-1) * sumc( (mCorr[][0]-meanc(mCorr[][0]))' * (mCorr[][1]-meanc(mCorr[][1])) );

        // calculate correlation coefficient
        vCorrLags[i][0] = sCov / ( sqrt(varc(mCorr[][0])) * sqrt(varc(mCorr[][1])) );
    }

    return vCorrLags;
}</pre>
</div>
</div></blockquote>
<p>It may prove useful to someone.</p>
</div>
        
    <div class="postmeta">
        
        <div class="author">
            <span>Posted by beberlei <kontakt@beberlei.de></span>
        </div>
        
        
        
        <div class="comments">
            <a href="http://www.whitewashing.de/2008/04/27/ox-cross-correlation-coefficients-with-lags.html#disqus_thread" data-disqus-identifier="2008/04/27/ox-cross-correlation-coefficients-with-lags">Leave a comment</a>
        </div>
    </div><div class="separator post_separator"></div>
        
        <div class="timestamp postmeta">
            <span>September 05, 2008</span> 
        </div>
        <?xml version="1.0" ?><div class="section" id="jquery-component-approved-for-extras-library">
<a href="2008/09/05/jquery-component-approved-for-extras-library.html"><h1>jQuery Component approved for extras library</h1></a>
<p>Yesterday both my jQuery Helper proposals (<a class="reference external" href="http://framework.zend.com/wiki/display/ZFPROP/ZendX_JQuery_View_Helper_JQuery+-+Benjamin+Eberlei">Core
Helper</a>,
<a class="reference external" href="http://framework.zend.com/wiki/display/ZFPROP/ZendX_JQuery+UI+Widgets+Extension+-+Benjamin+Eberlei?focusedCommentId=7373203#comment-7373203">UI
Widgets</a>)
for the Zend Framework have been accepted for development. I have
already checked my working prototypes <a class="reference external" href="http://framework.zend.com/svn/framework/extras/incubator/">into the Zend Framework
SVN</a>. In my
opinion the usage is quite stable already. There is likely to be no
argument flip, function renaming or whatsoever. I have renamed the
jqLink helper to ajaxLink though, because other libraries are offering
the same functionality to make Ajax related calls and this way the
learning curve for people using different libraries in different
projects may be more easy.</p>
<p>What is still missing? I have to add captureStart()/captureEnd()
functions to the Container Widgets Accordion and Tabs, and will create
additional pane helpers for both of them. This will likely be finished
this weekend and then there is only the documentation missing. I am very
confident this component will be finished for the Zend Framework 1.7
release later this year.</p>
<p>Since this component also includes helpers for the jQuery UI Widgets 1.6
release (which is not released yet), a little waiting time before
release is still good. I hope this all works out and the jQuery UI 1.6
release is in the Google CDN, when ZF 1.7 comes out.</p>
</div>
        
    <div class="postmeta">
        
        <div class="author">
            <span>Posted by beberlei <kontakt@beberlei.de></span>
        </div>
        
        
        
        <div class="comments">
            <a href="http://www.whitewashing.de/2008/09/05/jquery-component-approved-for-extras-library.html#disqus_thread" data-disqus-identifier="2008/09/05/jquery-component-approved-for-extras-library">Leave a comment</a>
        </div>
    </div><div class="separator post_separator"></div>
        
        <div class="timestamp postmeta">
            <span>September 11, 2008</span> 
        </div>
        <?xml version="1.0" ?><div class="section" id="new-calypso-dtl-version-0-2">
<a href="2008/09/11/new-calypso-dtl-version-0-2.html"><h1>New Calypso DTL Version 0.2</h1></a>
<p>I have got some hints about bugs and optimized the performance of loops
a little bit, so that you can now <a class="reference external" href="http://www.beberlei.de/sources/calypso-dtl-0.2.tar.gz">download version
0.2</a> of the
<a class="reference external" href="http://www.beberlei.de/calypso">Calypso DTL template engine</a>. Have
fun.</p>
</div>
        
    <div class="postmeta">
        
        <div class="author">
            <span>Posted by beberlei <kontakt@beberlei.de></span>
        </div>
        
        
        
        <div class="comments">
            <a href="http://www.whitewashing.de/2008/09/11/new-calypso-dtl-version-0-2.html#disqus_thread" data-disqus-identifier="2008/09/11/new-calypso-dtl-version-0-2">Leave a comment</a>
        </div>
    </div><div class="separator post_separator"></div>
        
        <div class="timestamp postmeta">
            <span>September 20, 2008</span> 
        </div>
        <?xml version="1.0" ?><div class="section" id="dependency-injection-via-interface-in-php-an-example">
<a href="2008/09/20/dependency-injection-via-interface-in-php-an-example.html"><h1>Dependency Injection via Interface in PHP: An example</h1></a>
<p>Personal projects and work currently both force me to think about
application design and I <a class="reference external" href="http://www.martinfowler.com/articles/injection.html">came accross dependency
injection</a> the
other day. Its quite a complex Design Pattern and hard to grasp, even
with the number of examples you can find in the internet. Basically
Dependency Injection means you register components that might be a
dependency for other components and when loading new classes via the
dependency injection framework, it knows of this relationsships and
assembles the object in need and all its dependencies and returns them
fully initialized. This pattern leads to completly encapsulated objects
where any class in the object graph can be exchanged for a new
implementation without breaking all its dependencies. It also makes
testing complex components and object relationsships very easy.</p>
<p>Asfar as I could find out, three different types of Dependency Injection
implementations exist: Via Constructor, via Setter and via Interfaces.
There exist implementations of Dependency Injection for Java (Spring)
that are configured via XML config files and seem very complex. They are
also hard to read in code I pressume, since you always have to be aware
of the current application configuration. There are also some more
lightweight implementations (PicoContainer) that assemble their
relationsships in the application and work with config methods that act
as configuration of the dependancies. <a class="reference external" href="http://www.martinfowler.com/articles/injection.html">Martin Folwer also discusses an
implementation via
interfaces</a>,
which seems most accessible for me.</p>
<p>All PHP clones of any dependancy injection framework seem to go the
complex way via configuration though. With traits and multiple class
inheritance on the horizon, some kind of interface injection seems
mighty powerful though. So I implemented a really lightweight
implementation of Interface Dependency Injection for PHP. The Container
works with static method only, is therefore in the global scope, such
that configuration is reduced to a minimum. Generally you have to write
interfaces for object injection, for example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">interface InjectDbAdapter</span>
<span class="x">{</span>
<span class="x">    public function injectDbAdapter(Zend_Db_Adapter_Abstract $db);</span>
<span class="x">}</span>
</pre></div>
</div>
<p>Other potential examples include “InjectLogger”, “InjectSoapClient”, or
“InjectAppConfig”. You then have to register a component for usage with
this interface:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">Whitewashing_Container::registerComponent('InjectDbAdapter', Zend_Db::factory($dbConfig));</span>
</pre></div>
</div>
<p>Now any class that implements the InjectDbAdapter interface can be
instantiated via:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">$obj = Whitewashing_Container::load('Class');</span>
</pre></div>
</div>
<p>and the loader takes care of calling the ‘Class’ implementation of
injectDbAdapter with the given Database Adapter. A negative consequence
of this approach is that you have to implement the inject methods for
all interfaces in your concrete class implementations. With Traits
(multiple class inheritence) being a new feature in PHP soon, injection
via parent classes seems to become a very powerful approach though,
which can handle the concrete implementations.</p>
<p>The Container takes care of all the dependancy building, so when testing
your components you can register lots of mock objects. You can also
exchange dependancies for only a subset of objects very easily. I
implemented a method “Whitewashing_Container::registerClassComponent”,
which registers a dependency component that is used with higher priority
in construction of the given class. You can also specify a third
parameter $localInterfaceOverride for the highest priority:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">$obj = Whitewashing_Container::load('Class', null, array('InjectDbAdapter' =&gt; $newDbAdapter));</span>
</pre></div>
</div>
<p>Speedwise the usage of the Container reduces class instatiation by about
50%, from 0.5 sec for 10000 classes with setting dependencies to 1 sec
on my machine. But naturally only classes with dependancies and lots of
them should be using this mechanism and with good application design,
this shouldn’t be to many. You can download
<a class="reference external" href="http://www.beberlei.de/sources/WhitewashingContainer.phps">Container</a>
and <a class="reference external" href="http://www.beberlei.de/sources/di.phps">Example</a> sourcecode, to
take a look. Currently this Container is not really creating new
dependencies for each new class generation but rather inverts the usage
of a registry. It should be an easy task to extend the registering
method to decide between new class generation and using the globally
registered class instance.</p>
</div>
        
    <div class="postmeta">
        
        <div class="author">
            <span>Posted by beberlei <kontakt@beberlei.de></span>
        </div>
        
        
        
        <div class="comments">
            <a href="http://www.whitewashing.de/2008/09/20/dependency-injection-via-interface-in-php-an-example.html#disqus_thread" data-disqus-identifier="2008/09/20/dependency-injection-via-interface-in-php-an-example">Leave a comment</a>
        </div>
    </div><div class="separator post_separator"></div>
        
        <div class="timestamp postmeta">
            <span>December 30, 2008</span> 
        </div>
        <?xml version="1.0" ?><div class="section" id="dependency-injection-with-php-introducing-sphicy">
<a href="2008/12/30/dependency-injection-with-php-introducing-sphicy.html"><h1>Dependency Injection with PHP: Introducing Sphicy</h1></a>
<p>I have written <a class="reference external" href="http://www.whitewashing.de/blog/articles/101">on dependency
injection</a> before
christmas and how <a class="reference external" href="http://code.google.com/p/guice">Guice</a>, googles DI
framework, offers a simple solution. I copied the functionality for a
PHP clone of Guice and named it
<a class="reference external" href="http://www.beberlei.de/sphicy">Sphicy</a>. You saw an early prototype of
it in the blogpost mentioned above.</p>
<p><a class="reference external" href="http://www.beberlei.de/sphicy">Sphicy</a> configures object dependencies
with modules: You explicitly state which implementation should be bound
to which interface. An injector then creates instances of these objects
via reflection: All constructor dependencies are resolved by looking at
the given type hints and initializes those according to the specified
bindings.</p>
<p>Two examples included in the <a class="reference external" href="http://www.beberlei.de/dev/svn/sphicy/">source code of
Sphicy</a> are <a class="reference external" href="http://framework.zend.com">Zend
Framework</a> and
<a class="reference external" href="http://www.ezcomponents.org">ezComponents</a> MVC bootstrapping modules.
Sadly both frameworks default front controllers are engineered in such a
way that useful dependency injection needs some workarounds.</p>
<p>As an example I will now discuss the Sphicy Module for Zend Framework
MVC applications. To circumvent the singleton and protected Constructor
of Zend_Controller_Front, we have to build a new front controller that
wraps around it and requires all the dependencies:</p>
<blockquote>
<div><div class="highlight-python"><pre>class Sphicy_Controller_Front
{
    protected $front;

    /**
     * Create Front Controller for Zend Framework using explicity dependencies created by Sphicy.
     *
     * @param Zend_Controller_Request_Abstract      $request
     * @param Zend_Controller_Response_Abstract     $response
     * @param Zend_Controller_Router_Interface      $router
     * @param Zend_Controller_Dispatcher_Interface  $dispatcher
     */
    public function __construct(
        Zend_Controller_Request_Abstract $request,
        Zend_Controller_Response_Abstract $response,
        Zend_Controller_Router_Interface $router,
        Zend_Controller_Dispatcher_Interface $dispatcher=null
    )
    {
        $front = Zend_Controller_Front::getInstance();
        $front-&gt;setRequest($request);
        $front-&gt;setResponse($response);
        $front-&gt;setRouter($router);

        if($dispatcher === null) {
            $dispatcher = $front-&gt;getDispatcher();
        }
        $front-&gt;setDispatcher($dispatcher);
    }

    public function dispatch()
    {
        $this-&gt;front-&gt;dispatch();
    }
}</pre>
</div>
</div></blockquote>
<p>You can see that the <strong>Sphicy_Controller_Front</strong> class requires
dependencies in its constructor that are then forward injected into
<strong>Zend_Controller_Front</strong>. You can now create a module that binds all
the required dependencies to concrete implementations, for example a
module for a Zend MVC Http Application might look like:</p>
<blockquote>
<div><div class="highlight-python"><pre>class Sphicy_ZendMvc_ExampleModule implements spModule {
     public function configure(spBinder $binder) {
         // Sphicy_Controller_Front does not extend Zend_Controller_Front, because of Singletonitis
         // It offers the dispatch method to proxy against Zend_Controller_Front::dispatch.
         $binder-&gt;bind(&quot;Sphicy_Controller_Front&quot;)-&gt;to(&quot;Sphicy_Controller_Front&quot;);
         $binder-&gt;bind(&quot;Zend_Controller_Request_Abstract&quot;)-&gt;to(&quot;Zend_Controller_Request_Http&quot;);
         $binder-&gt;bind(&quot;Zend_Controller_Response_Abstract&quot;)-&gt;to(&quot;Zend_Controller_Response_Http&quot;);
         // loads all routes
         $binder-&gt;bind(&quot;Zend_Controller_Router_Interface&quot;)-&gt;to(&quot;MyApplication_Router&quot;);
     }
 }</pre>
</div>
</div></blockquote>
<p>The class <strong>MyApplication_Router</strong> might look up all the routing
information of the application via a hardcoded configuration mechanism.
You may say this is a hard dependency, but actually you can just switch
modules or implementations at this position to replace the router with
another implementation. You can also see that no implementation for the
dispatcher is bound. But this dependency is optional and will be created
automatically as can be seen in the <strong>Sphicy_Controller_Front</strong> class.</p>
<p>The front controllers is now created by calling:</p>
<blockquote>
<div><div class="highlight-python"><pre>$injector = new spDefaultInjector(new Sphicy_ZendMvc_ExampleModule());
$front = $injector-&gt;getInstance(&quot;Sphicy_Controller_Front&quot;);
$front-&gt;dispatch();</pre>
</div>
</div></blockquote>
<p>What happens in the <strong>$injector-&gt;getInstance()</strong> line? Sphicy looks at
<strong>Sphicy_Controller_Front</strong>‘s constructor and finds that four
dependencies are needed: Request, Response, Router and Dispatcher
implementations. It looks up the bindings and searches for them,
creating Zend_Controller_Request_Http,
Zend_Controller_Response_Http and MyApplication_Router objects. A
dispatcher implementation is not found, but Sphicy recognizes that null
is a valid paramater and injects it. The 3 concrete implementations and
one null are instantiated and used to construct a valid
<strong>Sphicy_Controller_Front</strong> instance.</p>
<p>You have now stated the dependencies of the Zend Controller Front
explicitly and can switch them instantaneously by switching the bindings
of interface to implementations in the configuration module.</p>
<p>Have a look at the <a class="reference external" href="http://www.beberlei.de/sphicy">Sphicy Website</a> and
<a class="reference external" href="http://www.beberlei.de/sphicy/documentation/faq.html">FAQ</a> to see
more examples and information about the possibilites of this dependency
injection framework.</p>
</div>
        
    <div class="postmeta">
        
        <div class="author">
            <span>Posted by beberlei <kontakt@beberlei.de></span>
        </div>
        
        
        
        <div class="comments">
            <a href="http://www.whitewashing.de/2008/12/30/dependency-injection-with-php-introducing-sphicy.html#disqus_thread" data-disqus-identifier="2008/12/30/dependency-injection-with-php-introducing-sphicy">Leave a comment</a>
        </div>
    </div><div class="separator post_separator"></div>
        
        <div class="timestamp postmeta">
            <span>December 01, 2008</span> 
        </div>
        <?xml version="1.0" ?><div class="section" id="zend-jquery-enhancements-ajax-forms-tooltip-and-autofill">
<a href="2008/12/01/zend-jquery-enhancements-ajax-forms-tooltip-and-autofill.html"><h1>Zend + jQuery Enhancements: Ajax Forms, Tooltip and Autofill</h1></a>
<p>Some weeks ago <a class="reference external" href="http://framework.zend.com">Zend Framework 1.7</a> was
released with the <a class="reference external" href="http://jquery.com">jQuery</a> support I contributed.
What is the essential advantage of using jQuery support in ZF? You can
develop forms with ajax support either by using View Helpers or directly
by the integrated Zend_Form support. The implementation of a DatePicker
or AutoComplete functionality becomes as easy as using 2-3 lines of php
code.</p>
<p>Currently only support for the jQuery UI library is shipped, but you can
easily extend the jQuery support on your own and this blog post will
show you how using three very popular jQuery plugins:
<a class="reference external" href="http://malsup.com/jquery/form/">AjaxForm</a>,
<a class="reference external" href="http://bassistance.de/jquery-plugins/jquery-plugin-tooltip/">Tooltip</a>
and <a class="reference external" href="http://plugins.jquery.com/project/Autofill">AutoFill</a>. This will
be a series of installments, beginning with the first one: AjaxForms</p>
<p>AjaxForm allows you to enhance any form of yours to submit the data with
ajax to the server, so no additional overhead of loading a new page is
necessary. Combining the power of Zend_Form and jQuery’s ajaxForm you
can even go so far as differentiating between successful and
non-validated form submits. We will build a Form Decorator that
integrates the AjaxForm plugin in any of your Zend_Form’s. On submit it
will send the form data to the server via ajax and clears the form
afterwards. Clients that have javascript disabled will work too, the
form is submitted to the server in a standard pre-ajax fashion and
processed that way.</p>
<p>First what we need is obviously the new decorator, we will call it
“My_JQuery_Form_Decorator_AjaxForm” and it will inherit from
Zend_Form_Decorator_Form. What we then realize is, that this is just
using a view helper to render, so what we need additionally is a
“My_JQuery_View_Helper_AjaxForm” that extends from
“Zend_View_Helper_Form”. The code of the view helper will have to
look as follows to fullfil our needs:</p>
<blockquote>
<div><div class="highlight-python"><pre>require_once &quot;Zend/View/Helper/Form.php&quot;;class ZendX_JQuery_View_Helper_AjaxForm extends Zend_View_Helper_Form{  /**   * Contains reference to the jQuery view helper   *   * @var ZendX_JQuery_View_Helper_JQuery_Container   */  protected $jquery;  /**   * Set view and enable jQuery Core and UI libraries   *   * @param Zend_View_Interface $view   * @return ZendX_JQuery_View_Helper_Widget   */  public function setView(Zend_View_Interface $view)  {    parent::setView($view);    $this-&gt;jquery = $this-&gt;view-&gt;jQuery();    $this-&gt;jquery-&gt;enable()           -&gt;uiEnable();    return $this;  }  public function ajaxForm($name, $attribs = null, $content = false, array $options=array())  {    $id = $name;    if(isset($attribs['id'])) {      $id = $attribs['id'];    }    if(!isset($options['clearForm'])) {      $options['clearForm'] = true;    }    if(count($options) &gt; 0) {      require_once &quot;Zend/Json.php&quot;;      $jsonOptions = Zend_Json::encode($options);      // Fix Callbacks if present      if(isset($options['beforeSubmit'])) {        $jsonOptions = str_replace('&quot;beforeSubmit&quot;:&quot;'.$options['beforeSubmit'].'&quot;', '&quot;beforeSubmit&quot;:'.$options['beforeSubmit'], $jsonOptions);      }      if(isset($options['success'])) {        $jsonOptions = str_replace('&quot;success&quot;:&quot;'.$options['success'].'&quot;', '&quot;success&quot;:'.$options['success'], $jsonOptions);      }    } else {      $jsonOptions = &quot;{}&quot;;    }    $this-&gt;jquery-&gt;addOnLoad(sprintf(      '$(&quot;#%s&quot;).ajaxForm(%s)', $id, $jsonOptions    ));    return parent::form($name, $attribs, $content);  }}</pre>
</div>
</div></blockquote>
<p>It takes all the form-tag building of the inherited view helper for
granted and just appends the necessary jQuery code to the jQuery
onLoadActions stack. They will be outputted to the clients browser when
calling &lt;?php $this-&gt;jQuery(); ?&gt; in your layout or view script. Make
sure that you include the jQuery Form plugin in your code, for example
with &lt;?php $view-&gt;jQuery()-&gt;addJavascriptFile(..); &gt;</p>
<p>Programming the decorator becomes a simple trick now:</p>
<blockquote>
<div><div class="highlight-python"><pre>require_once &quot;Zend/Form/Decorator/Form.php&quot;;class My_JQuery_Form_Decorator_AjaxForm extends Zend_Form_Decorator_Form{  protected $_helper = &quot;ajaxForm&quot;;  protected $_jQueryParams = array();  public function getOptions()  {    $options = parent::getOptions();    if(isset($options['jQueryParams'])) {      $this-&gt;_jQueryParams = $options['jQueryParams'];      unset($options['jQueryParams']);      unset($this-&gt;_options['jQueryParams']);    }    return $options;  }  /**   * Render a form   *   * Replaces $content entirely from currently set element.   *   * @param string $content   * @return string   */  public function render($content)  {    $form  = $this-&gt;getElement();    $view  = $form-&gt;getView();    if (null === $view) {      return $content;    }    $helper    = $this-&gt;getHelper();    $attribs    = $this-&gt;getOptions();    $name     = $form-&gt;getFullyQualifiedName();    $attribs['id'] = $form-&gt;getId();    return $view-&gt;$helper($name, $attribs, $content, $this-&gt;_jQueryParams);  }}</pre>
</div>
</div></blockquote>
<p>Now to use either the decorator for your form, or just the view helper
to print your form tag with jQuery code you can invoke:</p>
<blockquote>
<div><div class="highlight-python"><pre>$form-&gt;addPrefixPath('My_JQuery_Form_Decorator', 'My/JQuery/Form/Decorator', 'decorator');$form-&gt;removeDecorator('Form')-&gt;addDecorator(array('AjaxForm', array(  'jQueryParams' =&gt; array(),)));$view-&gt;addHelperPath(&quot;My/JQuery/View/Helper&quot;, &quot;My_JQuery_View_Helper&quot;);$view-&gt;ajaxForm(&quot;formId1&quot;, $attribs, $content, $options);</pre>
</div>
</div></blockquote>
<p>Now we finished up the view side of our script. Assuming that we use the
Form Decorator instead of the View Helper, we can additionally add some
fancy logic and error handling ajax fun to the action controller that is
handling the Zend_Form instance.</p>
<blockquote>
<div><div class="highlight-python"><pre>class IndexController extends Zend_Controller_Action{  public function indexAction()  {    $foo = new MyAjaxTestForm();    try {      if(!$foo-&gt;isValid($_POST)) {        throw new Exception(&quot;Form is not valid!&quot;);      } else {        // do much saving and stuff here        if($this-&gt;getRequest()-&gt;isXmlHttpRequest()) {          $this-&gt;_helper-&gt;json(array(&quot;success&quot; =&gt; &quot;SUCCESSMESSAGEHERE&quot;));        }      }    } catch(Exception $e) {      if($this-&gt;getRequest()-&gt;isXmlHttpRequest()) {        $jsonErrors = array();        foreach( ( new RecursiveIteratorIterator(new RecursiveArrayIterator($form-&gt;getMessages())) ) AS $error) {          $jsonErrors[] = $error;        }        $this-&gt;_helper-&gt;json-&gt;sendJson($jsonErrors);      }    }  }}</pre>
</div>
</div></blockquote>
<p>This has to be processed by a callback function of the AjaxForm and
which may for example look like the following which uses a predefined
div box (#formMessages, dont forget to implement it) to render either
the success or the error messages.</p>
<blockquote>
<div><div class="highlight-python"><pre>$form-&gt;addDecorator(array('AjaxForm', array(  'jQueryParams' =&gt; array(    'success' =&gt; &quot;formCallback1&quot;,   ),)));$view-&gt;jQuery()-&gt;addJavascript('function formCallback1(data) {  if(data.errors) {    $(&quot;#formMessages&quot;).append(&quot;&lt;ul&gt;&quot;);    for each(var item in data.errors) {      $(&quot;#formMessages&quot;).append(&quot;&lt;li&gt;&quot;+item+&quot;&lt;/li&gt;&quot;);    }    $(&quot;#formMessages&quot;).append(&quot;&lt;/ul&gt;&quot;);  } else {    $(&quot;#formMessages&quot;).html(data.success);  }}');</pre>
</div>
</div></blockquote>
<p>This seems very complex, but you could include that javascript code into
the AjaxForm decorator and implement an Action Helper to do the action
controller side of the stuff. This will be an exercise for a future
post.</p>
<p>AutoFill and Tooltip extensions will be topic of the next installments
of this series, so be aware of new content soonish.</p>
</div>
        
    <div class="postmeta">
        
        <div class="author">
            <span>Posted by beberlei <kontakt@beberlei.de></span>
        </div>
        
        
        
        <div class="comments">
            <a href="http://www.whitewashing.de/2008/12/01/zend-jquery-enhancements-ajax-forms-tooltip-and-autofill.html#disqus_thread" data-disqus-identifier="2008/12/01/zend-jquery-enhancements-ajax-forms-tooltip-and-autofill">Leave a comment</a>
        </div>
    </div>
    
    <div class="related">
        <ul>
            <li>
                 &laquo; <a href="page6.html">Newer</a>
            </li>
            <li class="right">
                <a href="page8.html">Older</a> &raquo; 
            </li>
        </ul>
    </div>
    <div class="archive_link">
        <a href="archive.html"> &mdash; Blog Archive &mdash; </a>
    </div>


            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'whitewashing';
                var disqus_url = 'http://www.whitewashing.de/page7.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>         
        </div>
      </div>
    </div>

    <div class="span-8 last">
        
          
            <div class="yui-b" id="sidebar">
              
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

<div class="widget">
    <h3>Recent Posts</h3>
    <ul>
        <li>
            <a href="2012/06/03/setting_up_development_machines_with_puppet.html">Setting up Development Machines with Puppet</a>
        </li>
        <li>
            <a href="2012/05/31/virtual_machines_with_vagrant__veewee_and_puppet.html">Virtual Machines with Vagrant, Veewee and Puppet</a>
        </li>
        <li>
            <a href="2012/05/26/doctrine_goes_mit.html">Doctrine switches from LGPL to MIT</a>
        </li>
        <li>
            <a href="2012/02/25/symfony2_controller_testing.html">Symfony2 Controller Testing without Application</a>
        </li>
        <li>
            <a href="2010/02/07/resources-for-a-php-and-hudson-ci-integration.html">Resources for a PHP and Hudson CI Integration</a>
        </li>
        <li>
            <a href="2010/05/02/testing-database-locks-with-phpunit-and-gearman.html">Testing Database Locks with PHPUnit and Gearman</a>
        </li>
        <li>
            <a href="2010/01/08/immutable-datetime-objects.html">Immutable DateTime Objects</a>
        </li>
        <li>
            <a href="2010/01/10/application-lifecycle-management-and-deployment-with-pear-and-phar-revisited-update.html">Application Lifecycle Management and Deployment with PEAR and PHAR (revisited) UPDATE</a>
        </li>
        <li>
            <a href="2010/04/27/doctrine-2-beta-1-released.html">Doctrine 2 Beta 1 released</a>
        </li>
        <li>
            <a href="2010/04/18/new-netbeans-php-codesniffer-plugin-version.html">New Netbeans PHP CodeSniffer Plugin Version</a>
        </li>
    </ul>
</div>

        </div>
      </div>
            </div> 
          
        
    </div>
</div>

      <div class="clearer"></div>
    </div>
<div class="container">
    <div class="span-24 content">
        <div class="footer">
            &copy; Copyright 2008-2012, Benjamin Eberlei.
            Powered by <a href="http://www.tinkerer.me/">Tinkerer</a> and <a href="http://sphinx.pocoo.org/">Sphinx</a>.

        <script type="text/javascript">    var disqus_shortname = "whitewashing";    disqus_count();</script>
        </div>
    </div>
</div>

  </body>
</html>