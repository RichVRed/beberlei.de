



<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>REST and Ajax Aware controllers in ezcMvcTools &mdash; Whitewashing</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/disqus.js"></script>
    <script type="text/javascript" src="../../../_static/ga.js"></script>
    <link rel="shortcut icon" href="../../../_static/tinkerer.ico"/>
    
    <link rel="top" title="Whitewashing" href="../../../index.html" />
    <link rel="next" title="Bad news: jQuery UI 1.6 ships without Spinner and AutoComplete" href="../12/bad-news-jquery-ui-1-6-ships-without-spinner-and-autocomplete.html" />
    <link rel="prev" title="ezComponents 2008.2 Beta - Mvc separation for win" href="../03/ezcomponents-2008-2-beta-mvc-separation-for-win.html" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.html" /> 
  </head>
  <body>
<div class="container">
    <div id="header" class="span-8">
        <a href="../../../index.html"><img src="../../../_static/logo.jpg" alt="Whitewashing.de" /></a>
    </div>
    <div class="span-11" id="about">
        <p>
            Whitewashing is the blog of Benjamin Eberlei and covers topics in software-development and object-oriented-design. Benjamin works
            for <a href="http://qafoo.com/" target="_blank">Qafoo</a> and you can book him for consulting and trainings.
        </p>
    </div>
    <div class="span-5 last">
        <p class="buttons" style="text-align: right">
            <a href="https://twitter.com/beberlei"><img src="../../../_static/twitter-logo.png" alt="Follow me on twitter" height="50" /></a>
            <a href="http://www.whitewashing.de/rss.xml"><img src="../../../_static/rss2.png" alt="Subscribe to RSS" height="50" /></a>
            <a href="https://github.com/beberlei"><img src="../../../_static/github-logo.png" alt="My Github Profile" height="50" /></a>
        </p>
    </div>
</div>



    <div class="document">
<div class="container">
    
    <div class="span-24 content">
      <div>
        <div>
          <div id="2008-12-04-rest-and-ajax-aware-controllers-in-ezcmvctools">
            
            
    
    <div class="related">
        <ul>
            <li>
                 &laquo; <a href="../03/ezcomponents-2008-2-beta-mvc-separation-for-win.html">ezComponents 2008.2 Beta - Mvc separation for win</a>
            </li>
            <li class="right">
                <a href="../12/bad-news-jquery-ui-1-6-ships-without-spinner-and-autocomplete.html">Bad news: jQuery UI 1.6 ships without Spinner and AutoComplete</a> &raquo; 
            </li>
        </ul>
    </div>
    
        <div class="timestamp postmeta">
            <span>December 04, 2008</span> 
        </div>
    <div class="section" id="rest-and-ajax-aware-controllers-in-ezcmvctools">
<h1>REST and Ajax Aware controllers in ezcMvcTools</h1>
<p>There are essentially two major different ways to implement a restful
application using a web framework. You either implement a router that
routes to different controller actions based on the HTTP method used on
a requested resource. This is the fancy way, which sadly is not always
so practical because many browsers do not support sending more than GET
and POST requests. The other way would be to define suburls of a
resource such as <strong>/user/1/delete</strong> for the resource <strong>/user/1</strong> and
take GET a a request for deleting and POST for the confirmation of the
delete.</p>
<p>ezcMvcTools HTTP Request Parser and routing mechanisms currently offer
no real help to decide on this issues, but its easy to extend this
missing functionality. What we first add are simple checks of the
current http request method. We extend <strong>ezcMvcHttpRequestParser</strong> which
will return a derived <strong>ezcMvcRequest</strong> object that implements 7 new
methods: isPost(), isGet(), isDelete(), isPut(), isXmlHttpRequest(),
isMethod() and getMethod(). These methods can now be easily used on the
request object to determine which action will be undertaken:</p>
<blockquote>
<div><div class="highlight-python"><pre>class myMvcRequest extends ezcMvcRequest{  public function isPost()  {    return $this-&gt;isMethod("POST");  }  public function isGet()  {    return $this-&gt;isMethod("GET");  }  public function isPut()  {    return $this-&gt;isMethod("PUT");  }  public function isDelete()  {    return $this-&gt;isMethod("DELETE");  }  public function isXmlHttpRequest()  {    if(isset($this-&gt;raw['HTTP_X_REQUESTED_WITH'])      &amp;&amp; strtolower($this-&gt;raw['HTTP_X_REQUESTED_WITH']) == "xmlhttprequest") {      return true;    }    return false;  }    public function getMethod()  {    if(isset($this-&gt;raw['REQUEST_METHOD']))      return strtolower($this-&gt;raw['REQUEST_METHOD']);    }    return false;  }  public function isMethod($method)  {    if(isset($this-&gt;raw['REQUEST_METHOD']) &amp;&amp;       $this-&gt;getMethod() == strtolower($method)) {      return true;    }    return false;  }}class myMvcHttpRequestParser extends ezcMvcHttpRequestParser{  /**   * Uses the data from the superglobals.   *   * @return ezcMvcRequest   */  public function createRequest()  {    $this-&gt;request = new myMvcRequest;    $this-&gt;processStandardHeaders();    $this-&gt;processAcceptHeaders();    $this-&gt;processUserAgentHeaders();    $this-&gt;processFiles();    $this-&gt;processAuthVars();    $this-&gt;request-&gt;raw = &amp;$_SERVER;    return $this-&gt;request;  }}</pre>
</div>
</div></blockquote>
<p>This helps us to implement simple decision mechanisms in a single
controller action that takes both POST and GET requests. From the point
separation of concerns this is not a good design decision. We need
routes that can point to different controller actions based on their
request method, so that two requests <strong>GET /user/1/delete</strong> and <strong>POST
/user/1/delete</strong> lead to different methods, for example
<strong>userController::doDeleteDialog</strong> and <strong>userController::doDelete</strong>. We
will simply extend the <strong>ezcMvcRailsRoute</strong> to support decision based on
http request methods:</p>
<blockquote>
<div><div class="highlight-python"><pre>class myMvcRestRoute extends ezcMvcRailsRoute{  protected $method;  public function __construct( $method, $pattern, $controllerClassName, $action = null, array $defaultValues = array() )  {    $this-&gt;method = $method;    parent::__construct($pattern, $controllerClassName, $action, $defaultValues);  }  public function matches( ezcMvcRequest $request )  {    if(strtolower($this-&gt;method) == strtolower($request-&gt;raw['REQUEST_METHOD'])) {      return parent::matches($request);    }    return null;  }}</pre>
</div>
</div></blockquote>
<p>This very simple extension is independent of the advanced request parser
given above, so you could use it separately. In the light of our delete
user example, you would use the new router in the following way:</p>
<blockquote>
<div><div class="highlight-python"><pre>class myRouter extends ezcMvcRouter{  public function createRoutes()  {    return array(      new myMvcRestRoute( 'GET', '/users/:id/delete', 'UserController', 'deleteDialog' ),      new myMvcRestRoute( 'POST', '/users/:id/delete', 'UserController', 'delete' ),    );  }}</pre>
</div>
</div></blockquote>
<p>We have now simple rest route support in our ezcMvcTools application.</p>
</div>

    
    <div class="postmeta">
        
        <div class="author">
            <span>Posted by beberlei <kontakt@beberlei.de></span>
        </div>
        
        
        
    </div>
    <div id="disqus_thread"></div><script type="text/javascript">    var disqus_shortname = "whitewashing";    var disqus_identifier = "2008/12/04/rest-and-ajax-aware-controllers-in-ezcmvctools";    disqus_thread();</script><noscript>Please enable JavaScript to view the    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'whitewashing';
                var disqus_url = 'http://www.whitewashing.de/2008/12/04/rest-and-ajax-aware-controllers-in-ezcmvctools.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>         
        </div>
      </div>
    </div>

    <div class="span-24 last">
        
          
            <div class="yui-b" id="sidebar">
              
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

<div class="widget">
    <h3>Recent Posts</h3>
    <ul>
        <li class="recent_post">
            <a href="../../../2013/12/05/feature_flags_and_doctrine_entities.html">Feature Flags and Doctrine Entities</a>
        </li>
        <li class="recent_post">
            <a href="../../../2013/11/19/setting_up_development_machines_ansible_edition.html">Setting up development machines: Ansible edition</a>
        </li>
        <li class="recent_post">
            <a href="../../../2013/09/04/decoupling_from_symfony_security_and_fosuserbundle.html">Decoupling from Symfony Security and FOSUserBundle</a>
        </li>
        <li class="recent_post">
            <a href="../../../2013/08/19/speedup_symfony2_on_vagrant_boxes.html">Speedup Symfony2 on Vagrant boxes</a>
        </li>
        <li class="recent_post">
            <a href="../../../2013/08/09/your_service_layer_benefits_from_a_dispatcher.html">Your Service Layer benefits from a Dispatcher</a>
        </li>
        <li class="recent_post">
            <a href="../../../2013/07/24/doctrine_and_domainevents.html">Doctrine and Domain Events</a>
        </li>
        <li class="recent_post">
            <a href="../../../2013/06/27/extending_symfony2__controller_utilities.html">Extending Symfony2: Controller Utilities</a>
        </li>
        <li class="recent_post">
            <a href="../../../2013/06/24/bounded_contexts.html">Bounded Contexts</a>
        </li>
        <li class="recent_post">
            <a href="../../../2013/05/23/symfony2_on_windows_azure_websites.html">Symfony2 on Windows Azure Websites</a>
        </li>
        <li class="recent_post">
            <a href="../../../2013/04/12/traits_are_static_access.html">Traits are Static Access</a>
        </li>
    </ul>
</div>

        </div>
      </div>
            </div> 
          
        
    </div>
</div>

      <div class="clearer"></div>
    </div>
<div class="container">
    <div class="span-24 content">
        <div class="footer">
            &copy; Copyright 2008-2012, Benjamin Eberlei.
            Powered by <a href="http://www.tinkerer.me/">Tinkerer</a> and <a href="http://sphinx.pocoo.org/">Sphinx</a>.

        
        </div>
    </div>
</div>

  </body>
</html>