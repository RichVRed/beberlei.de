



<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Decoupling from Symfony Security and FOSUserBundle &mdash; Whitewashing</title>
    
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/disqus.js"></script>
    <script type="text/javascript" src="../../../_static/ga.js"></script>
    <link rel="shortcut icon" href="../../../_static/tinkerer.ico"/>
    
    <link rel="top" title="Whitewashing" href="../../../index.html" />
    <link rel="next" title="Speedup Symfony2 on Vagrant boxes" href="../../08/19/speedup_symfony2_on_vagrant_boxes.html" />
    <link rel="prev" title="Setting up development machines: Ansible edition" href="../../11/19/setting_up_development_machines_ansible_edition.html" />
    <link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.html" /> 
  </head>
  <body>
<div class="container">
    <div id="header" class="span-8">
        <a href="../../../index.html"><img src="../../../_static/logo.jpg" alt="Whitewashing.de" /></a>
    </div>
    <div class="span-11" id="about">
        <p>
            Whitewashing is the blog of Benjamin Eberlei and covers topics in software-development and object-oriented-design. Benjamin works
            for <a href="http://qafoo.com/" target="_blank">Qafoo</a> and you can book him for consulting and trainings.
        </p>
    </div>
    <div class="span-5 last">
        <p class="buttons" style="text-align: right">
            <a href="https://twitter.com/beberlei"><img src="../../../_static/twitter-logo.png" alt="Follow me on twitter" height="50" /></a>
            <a href="http://www.whitewashing.de/rss.xml"><img src="../../../_static/rss2.png" alt="Subscribe to RSS" height="50" /></a>
            <a href="https://github.com/beberlei"><img src="../../../_static/github-logo.png" alt="My Github Profile" height="50" /></a>
        </p>
    </div>
</div>



    <div class="document">
<div class="container">
    
    <div class="span-24 content">
      <div>
        <div>
          <div id="2013-09-04-decoupling_from_symfony_security_and_fosuserbundle">
            
            
    
    <div class="related">
        <ul>
            <li>
                 &laquo; <a href="../../11/19/setting_up_development_machines_ansible_edition.html">Setting up development machines: Ansible edition</a>
            </li>
            <li class="right">
                <a href="../../08/19/speedup_symfony2_on_vagrant_boxes.html">Speedup Symfony2 on Vagrant boxes</a> &raquo; 
            </li>
        </ul>
    </div>
    
        <div class="timestamp postmeta">
            <span>September 04, 2013</span> 
        </div>
    <div class="section" id="decoupling-from-symfony-security-and-fosuserbundle">
<h1>Decoupling from Symfony Security and FOSUserBundle</h1>
<p>In this blog post I will show how to decouple your core application
from the Symfony Security component and User bundles such as the FOSUserBundle.</p>
<p>In my opinion a framework has to be evaluated by how much it allows you to hide
it from your actual application. This blog post will add another perspective on
how to achieve decoupling from Symfony user and security with a very simple
approach. With this puzzle piece and others I wrote about before (<a class="reference external" href="http://whitewashing.de/2013/06/27/extending_symfony2__controller_utilities.html">Controllers
as Service</a>,
<a class="reference external" href="http://whitewashing.de/2013/02/19/extending_symfony2__paramconverter.html">Param Converters</a>)
and other pieces I still need to write about, I would classify Symfony2 as a
good framework.</p>
<p>A number of other authors have written blog posts on decoupling Symfony and your model
code as well, such as William Durand <a class="reference external" href="http://williamdurand.fr/2013/08/07/ddd-with-symfony2-folder-structure-and-code-first/">on project structure</a>
, Matthias Verraes <a class="reference external" href="http://verraes.net/2011/10/code-folder-structure/">on project structure as well</a>
and on <a class="reference external" href="http://verraes.net/2013/04/decoupling-symfony2-forms-from-entities/">Decoupling Forms from Entities</a>.</p>
<p>User management breaks the isolation of your business model open,
by introducing the <tt class="docutils literal"><span class="pre">UserInterface</span></tt> from the Security component into your
code base. In combination with the <em>FOSUserBundle</em> this can cause a dependency
on quite a bit of code already because I wouldn&#8217;t call the <tt class="docutils literal"><span class="pre">FOS\UserBundle\Model\User</span></tt> object
leightweight. However this and other FriendsOfSymfony bundles
are very helpful to get annoying features of your application done in a matter
of hours.</p>
<p>You can decouple the <em>FOSUserBundle</em> from our own entities and code by
introducing a second object that representes the user concept in our model.
The <tt class="docutils literal"><span class="pre">UserInterface</span></tt> entities need fields for username, password, enabled and
some more. Except the username and email, the business model rarely needs other
properties.</p>
<p>Take an ecommerce system as example, where customers can register as users.
In this example we could create two entities <tt class="docutils literal"><span class="pre">MyProject\UserBundle\Entity\User</span></tt> and
<tt class="docutils literal"><span class="pre">MyProject\ShopBundle\Entity\Customer</span></tt>. Two strategies exist now:</p>
<ol class="arabic simple">
<li>Use the same table for both entities with some shared and other exclusive columns</li>
<li>Use different tables in the database</li>
</ol>
<p>I haven&#8217;t tried the first option yet, so I cannot say much about the feasibility.</p>
<p>For case two, the <tt class="docutils literal"><span class="pre">User</span></tt> entity looks like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// src/MyProject/UserBundle/Entity/User.php;</span>

<span class="k">namespace</span> <span class="nx">MyProject\UserBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">FOS\UserBundle\Model\User</span> <span class="k">as</span> <span class="nx">BaseUser</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Doctrine\ORM\Mapping</span> <span class="k">as</span> <span class="nx">ORM</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @ORM\Entity</span>
<span class="sd"> * @ORM\Table(name=&quot;fos_user&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">BaseUser</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @ORM\Id</span>
<span class="sd">     * @ORM\Column(type=&quot;integer&quot;)</span>
<span class="sd">     * @ORM\GeneratedValue(strategy=&quot;AUTO&quot;)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">Customer</span></tt> entity is a completly new object, not depending
on the <tt class="docutils literal"><span class="pre">UserInterface</span></tt> and containing some duplicated properties.</p>
<p>You can either use exactly the same ID or plant the <tt class="docutils literal"><span class="pre">$userId</span></tt> as
correlation ID in the <tt class="docutils literal"><span class="pre">Customer</span></tt> object.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// src/MyProject/ShopBundle/Entity/Customer.php</span>

<span class="k">namespace</span> <span class="nx">MyProject\ShopBundle\Entity</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\ORM\Mapping</span> <span class="k">as</span> <span class="nx">ORM</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * @ORM\Entity</span>
<span class="sd"> * @ORM\Table(name=&quot;customer&quot;)</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">Customer</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @ORM\Id</span>
<span class="sd">     * @ORM\Column(type=&quot;integer&quot;)</span>
<span class="sd">     * @ORM\GeneratedValue(strategy=&quot;NONE&quot;)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$id</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @ORM\Column(type=&quot;string&quot;)</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$username</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now you need to extend the application to synchronize all changes from the
<tt class="docutils literal"><span class="pre">User</span></tt> entity to the <tt class="docutils literal"><span class="pre">Customer</span></tt> entity. You can
achieve this relatively easy by overwriting the <tt class="docutils literal"><span class="pre">ModelManager</span></tt> or when finally
supported by <em>FOSUserBundle</em> listening to events.  Your own code can
exclusively work with <tt class="docutils literal"><span class="pre">Customer</span></tt> objects now, void of any reference to
the Symfony Security component or the huge FOSUserBundle dependency.</p>
</div>

    
    <div class="postmeta">
        
        <div class="author">
            <span>Posted by Benjamin Eberlei</span>
        </div>
        
        <div class="categories">
            <span>
                Filed under:
                
                    <a href="../../../categories/php.html">PHP</a>,
                
                    <a href="../../../categories/symfony2.html">Symfony2</a>
                
            </span>
        </div>
        
        <div class="tags">
            <span>
                Tags:
                
                    <a href="../../../tags/php.html">PHP</a>,
                
                    <a href="../../../tags/symfony2.html">Symfony2</a>
                
            </span>
        </div>
        
    </div>
    <div id="disqus_thread"></div><script type="text/javascript">    var disqus_shortname = "whitewashing";    var disqus_identifier = "2013/09/04/decoupling_from_symfony_security_and_fosuserbundle";    disqus_thread();</script><noscript>Please enable JavaScript to view the    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'whitewashing';
                var disqus_url = 'http://www.whitewashing.de/2013/09/04/decoupling_from_symfony_security_and_fosuserbundle.html';
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
          </div>         
        </div>
      </div>
    </div>

    <div class="span-24 last">
        
          
            <div class="yui-b" id="sidebar">
              
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

<div class="widget">
    <h3>Recent Posts</h3>
    <ul>
        <li class="recent_post">
            <a href="../../12/05/feature_flags_and_doctrine_entities.html">Feature Flags and Doctrine Entities</a>
        </li>
        <li class="recent_post">
            <a href="../../11/19/setting_up_development_machines_ansible_edition.html">Setting up development machines: Ansible edition</a>
        </li>
        <li class="recent_post">
            <a href="#">Decoupling from Symfony Security and FOSUserBundle</a>
        </li>
        <li class="recent_post">
            <a href="../../08/19/speedup_symfony2_on_vagrant_boxes.html">Speedup Symfony2 on Vagrant boxes</a>
        </li>
        <li class="recent_post">
            <a href="../../08/09/your_service_layer_benefits_from_a_dispatcher.html">Your Service Layer benefits from a Dispatcher</a>
        </li>
        <li class="recent_post">
            <a href="../../07/24/doctrine_and_domainevents.html">Doctrine and Domain Events</a>
        </li>
        <li class="recent_post">
            <a href="../../06/27/extending_symfony2__controller_utilities.html">Extending Symfony2: Controller Utilities</a>
        </li>
        <li class="recent_post">
            <a href="../../06/24/bounded_contexts.html">Bounded Contexts</a>
        </li>
        <li class="recent_post">
            <a href="../../05/23/symfony2_on_windows_azure_websites.html">Symfony2 on Windows Azure Websites</a>
        </li>
        <li class="recent_post">
            <a href="../../04/12/traits_are_static_access.html">Traits are Static Access</a>
        </li>
    </ul>
</div>

        </div>
      </div>
            </div> 
          
        
    </div>
</div>

      <div class="clearer"></div>
    </div>
<div class="container">
    <div class="span-24 content">
        <div class="footer">
            &copy; Copyright 2008-2012, Benjamin Eberlei.
            Powered by <a href="http://www.tinkerer.me/">Tinkerer</a> and <a href="http://sphinx.pocoo.org/">Sphinx</a>.

        
        </div>
    </div>
</div>

  </body>
</html>